// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  relationMode = "prisma"
}

model ActivateToken {
  Id                  Int                     @id @default(autoincrement()) @map("id")
  uuid                String                  @default(uuid()) 
  token               String                  @unique
  activatedAt         DateTime?

  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @default(now()) @updatedAt

  user                User                    @relation(fields: [userId], references: [id])
  userId              Int                     @unique
}

model Account { 
  Id                      Int                 @id @default(autoincrement()) @map("id")
  uuid                    String              @default(uuid()) 
  type                    String
  provider                String
  providerAccountId       String
  refresh_token           String?       
  access_token            String?       
  expires_at              Int? 
  token_type              String?
  scope                   String?
  id_token                String?       
  session_state           String?
  createdAt               DateTime                @default(now())
  updatedAt               DateTime                @default(now()) @updatedAt

  user                    User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                  Int                 @unique
  @@unique([provider, providerAccountId])
}

model Channel {
  Id                      Int                 @id @default(autoincrement()) @map("id")
  uuid                    String              @default(uuid())
  name                    String
  type                    ChannelType         @default(TEXT)

  profile                 Profile             @relation(fields: [profileId], references: [Id], onDelete: Cascade)
  profileId               Int

  serverId                Int
  server                  Server              @relation(fields: [serverId], references: [Id], onDelete: Cascade)

  messages                Message[]

  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @default(now()) @updatedAt

  @@index([profileId])
  @@index([serverId])
}

model Conversation {
  Id                      Int                 @id @default(autoincrement()) @map("id")
  uuid                    String              @default(uuid())
  memberOneId             Int
  memberOne               Member              @relation("MemberOne", fields: [memberOneId], references: [Id], onDelete: Cascade)

  memberTwoId             Int
  memberTwo               Member              @relation("MemberTwo", fields: [memberTwoId], references: [Id], onDelete: Cascade)

  directMessages          DirectMessage[]

  @@index([memberOneId])
  @@index([memberTwoId])

  @@unique([memberOneId, memberTwoId])
}

model DirectMessage {
  Id                      Int                 @id @default(autoincrement()) @map("id")
  uuid                    String              @default(uuid())
  content                 String              @db.Text
  fileUrl                 String?             @db.Text

  memberId                Int
  member                  Member              @relation(fields: [memberId], references: [Id], onDelete: Cascade)

  conversationId          Int
  conversation            Conversation        @relation(fields: [conversationId], references: [Id], onDelete: Cascade)

  deleted                 Boolean             @default(false)

  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @updatedAt

  @@index([memberId])
  @@index([conversationId])
}

model Favorite {
  Id                      Int                 @id @default(autoincrement()) @map("id")
  uuid                    String              @default(uuid())
  userfavorite            User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                  Int                 @unique
}

model Listing {   
  Id                      Int                 @id @default(autoincrement()) @map("id")
  uuid                    String              @default(uuid())
  title                   String    
  description             String    
  imageSrc                String    
  category                String    
  locationValue           String    
  price                   Int   
  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @default(now()) @updatedAt

  userResrvation          User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  reservations            Reservation[]   
  userId                  Int                 @unique
}
model Like {   
  Id                      Int                 @id @default(autoincrement()) @map("id")
  uuid                    String              @default(uuid())
  likeWhoUserIdLiked      Int?
  likeUserId              Int?
  likePhotoId             Int?
  likePicThreadId         Int?
  likeThreadId            Int?
  likeListingId           Int?
  price                   Int?  
  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @default(now()) @updatedAt
}

model Member {
  Id                      Int                 @id @default(autoincrement()) @map("Id")
  uuid                    String              @default(uuid())
  role                    MemberRole          @default(GUEST)

  profile                 Profile             @relation(fields: [profileId], references: [Id], onDelete: Cascade)
  profileId               Int

  serverId                Int
  server                  Server              @relation(fields: [serverId], references: [Id], onDelete: Cascade)

  messages                Message[]
  directMessages          DirectMessage[]

  conversationsInitiated  Conversation[]      @relation("MemberOne")
  conversationsReceived   Conversation[]      @relation("MemberTwo")

  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @updatedAt

  @@index([profileId])
  @@index([serverId])
}

model Message {
  Id                      Int                 @id @default(autoincrement()) @map("id")
  uuid                    String              @default(uuid())
  content                 String              @db.Text

  fileUrl                 String?             @db.Text

  memberId                Int
  member                  Member              @relation(fields: [memberId], references: [Id], onDelete: Cascade)

  channelId               Int
  channel                 Channel             @relation(fields: [channelId], references: [Id], onDelete: Cascade)

  deleted Boolean                             @default(false)

  createdAt DateTime                          @default(now())
  updatedAt DateTime                          @updatedAt

  @@index([channelId])
  @@index([memberId])
}

model Post {
  Id                      Int                 @id @default(autoincrement()) @map("id")
  uuid                    String              @default(uuid())
  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @updatedAt
  title                   String              @db.VarChar(255)
  content                 String?     
  published               Boolean             @default(false)
 
  author                  User                @relation(fields: [authorId], references: [id], onDelete: Cascade)
  authorId                Int                 @unique
}

model Profile {
  Id                      Int                 @id @default(autoincrement()) @map("id")
  uuid                    String              @default(uuid())
  name                    String      
  bio                     String?     
  imageUrl                String?             @db.Text
  userProfile             User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                  Int                 @unique

  servers Server[]
  members Member[]
  channels Channel[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model Reservation {       
  Id                      Int                 @id @default(autoincrement()) @map("id")
  uuid                    String              @default(uuid())
  startDate               DateTime    
  endDate                 DateTime    
  totalPrice              Int   
  createdAt               DateTime            @default(now())

  userListing User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId Int  @unique
  listing Listing @relation(fields: [listingId], references: [Id], onDelete: Cascade)
  listingId Int  @unique
}

model Server {
  Id                      Int                 @id @default(autoincrement()) @map("id")
  uuid                    String              @unique @default(uuid())
  name                    String
  imageUrl                String              @db.Text
  inviteCode              String              @unique

  profileId               Int
  profile                 Profile             @relation(fields: [profileId], references: [Id], onDelete: Cascade)

  members                 Member[]
  channels                Channel[]

  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @default(now()) @updatedAt

  @@index([profileId])
}

model User {  
  id                  Int                     @id @default(autoincrement())
  uuid                String                  @default(uuid()) 
  name                String? 
  email               String                  @unique
  emailVerified       DateTime? 
  image               String? 
  hashedPassword      String? 
  firstName           String? 
  lastName            String? 
  role                String?
  nickname            String? 
  show_fullname       Int?                    @default(0)
  zipcode             String? 
  profile_blob        String? 
  profile_type        String? 
  profile_blob_time   String? 
  show_mylocation     Int?                    @default(0)
  country             String? 
  bdaymonth           String? 
  bdayday             String? 
  bdayyear            String? 
  ethnicity           String? 
  religion            String? 
  showreligion        Int?                    @default(0)
  sex                 String? 
  orientation         String? 
  relstatus           String? 
  show_relstatus      Int?                    @default(0)
  show_orientation    Int?                    @default(0)
  pointsvalue         Int?                    @default(0)
  last_loggedin       String? 
  aboutme             String? 
  updatedAt           DateTime                @default(now()) @updatedAt
  createdAt           DateTime                @default(now())
  favoriteIds         Favorite[]    
  posts               Post[]  
  profile             Profile?
  UserFriends         UserFriend[]
  UserConnections     UserConnection[]
  UserPhotos          UserPhoto[]
  UserLedger          UserLedger[]
  UserLedgerSysCredits          UserLedgerSysCredit[]
  UserThreads         UserThread[]
  UserPhotoThreads      UserPhotoThread[]
  account             Account[]
  listing             Listing[]
  reservation         Reservation[]
  ActivateToken       ActivateToken[]
} 

model UserConnection {
  Id Int @id @default(autoincrement()) @map("id")
  uuid String @default(uuid())
  user_idone Int                    
  user_idone_time DateTime
  smashandpass_user_idtwo Int
  smashandpass_user_idtwo_time DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId Int

  @@index([userId])
}

model UserFriend {
  Id Int @id @default(autoincrement()) @map("id")
  uuid String @default(uuid())
  friendUserId Int                    
  friendOkUserId Int
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId Int

  @@index([userId])
}

model UserLedger {
  Id Int @id @default(autoincrement()) @map("id")
  uuid String @default(uuid())
  userledger_log_descrp Int                    
  userledger_log_ownerid Int
  userledger_log_buyerid Int
  userledger_log_typtransc Int
  user_ledger_price Int
  userledger_log_amount Int
  userledger_log_batched_time DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId Int

  userLedgerSysCredit UserLedgerSysCredit @relation(fields: [userLedgerSysCreditId], references: [Id], onDelete: Cascade)
  userLedgerSysCreditId  Int

  @@index([userId])
  @@index([userLedgerSysCreditId])
}

model UserLedgerSysCredit {
  Id Int @id @default(autoincrement()) @map("id")
  uuid String @default(uuid())
  userledger_log_descrp Int                    
  userledger_log_ownerid Int
  userledger_log_buyerid Int
  userledger_log_typtransc Int
  user_ledger_price Int
  userledger_log_amount Int
  userledger_log_batched_time DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  
  userLedger UserLedger []

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId Int
  
  @@index([userId])
}

model UserPhoto {
  Id Int @id @default(autoincrement()) @map("id")
  uuid String @default(uuid())
  serverCaption String?
  userCaption String?
  imageSize Int?
  type String
  local String
  url String
  filename String
  message String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  
  UserPhotoThreads   UserPhotoThread[]

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId Int

  @@index([userId])
}

model UserThread {
  Id Int                  @id @default(autoincrement()) @map("id")
  uuid String             @default(uuid())
  status Int              @default(0)
  belongsTouser_id Int
  html String
  deletedAt DateTime 
  createdAt DateTime      @default(now())
  updatedAt DateTime      @default(now()) @updatedAt
  
  user User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId Int

  @@index([userId])
}

model UserPhotoThread {
  Id Int @id @default(autoincrement()) @map("id")
  uuid String @default(uuid())
  touser_id String?
  fromuserid Int?
  fromuser_timzone String
  
  deletedAt DateTime 
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  
  UserPhoto UserPhoto @relation(fields: [UserPhotoId], references: [Id], onDelete: Cascade)
  UserPhotoId Int

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId Int

  @@index([userId])
  @@index([UserPhotoId])
}

enum MemberRole {
  ADMIN
  MODERATOR
  GUEST
}

enum ChannelType {
  TEXT
  AUDIO
  VIDEO
}

